<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    </script>       
    <script type="text/javascript">
		jQuery(document).ready(function() {
		    jQuery(document).on("click", ".button", function(e) {
		    	$("#wait").slideDown();
		        e.preventDefault();
		        var dateTime = $("#text").val();          
		        var seconds = $("#seconds").val();
		        initialize(dateTime, seconds);
		    });

		function initialize(dateTime, seconds) {
	    	  var latlng = new google.maps.LatLng(40, 116);
	    	  var mapOptions = {
	    	    zoom: 9,
	    	    center: latlng,
	    	    mapTypeId: google.maps.MapTypeId.ROADMAP
	    	  }
	    	  map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
	    	  getLocations(dateTime, seconds);
	    }
    
	    function moveToLocation(lat, lng){
	        var center = new google.maps.LatLng(lat, lng);
	        // using global variable:
	        map.panTo(center);
	    }
    
		function getLocations(dateTime, seconds) {

			$.getJSON("http://localhost:8080/plague/PlotTest?dateTime="+dateTime+"&seconds="+seconds, function (data) {

				var location;

				$.each(data.userLocationSnapshots, function (i, item) {
					addMarker(item.temporalLocation.lat,item.temporalLocation.lng, item.user.id, item.temporalLocation.timestamp.split(/\./)[0]);
				});

			});
		}

		function addMarker(lat,lng,userId,ts) {
				var marker = new google.maps.Marker({
					position: new google.maps.LatLng(lat,lng),
					map: map,
				    title: "userId: " + userId + " timestamp:" + ts
				});
	            google.maps.event.addListener(marker, 'click', function()
                {
                    var infowindow = new google.maps.InfoWindow(
                        {
                            content: '<div style="height: 100px">' + marker.title + '</div>'
                        });
                    infowindow.open(map, marker);
                });
				moveToLocation(lat,lng);
		}
		}); 
	</script>
</head>
<body>
find users records within +- <input type="text" id="seconds" name="name" value="12000" size=5 /> seconds 
 of datetime: <input type="text" id="text" name="name" value="2008-11-15T10:13:36" /> <br><a href="#" class="button"><button>Search</button></a>
                                <div id="wait" style="display: none;">Please wait a moment...searching. Clickable markers will show up in a moment.</div>
    <p>This tool helps you find data points that exist in our system. It will produce user locations near the time you enter. Then you can use one of these user/timestamp combos
    to enter into the <a href="index.html">infection simulator</a></p>
    
    <div id="map-canvas"></div>
</body>
</html>